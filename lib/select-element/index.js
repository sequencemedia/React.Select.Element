'use strict';Object.defineProperty(exports,"__esModule",{value:true});exports.SelectElement=undefined;var _getPrototypeOf=require('babel-runtime/core-js/object/get-prototype-of');var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=require('babel-runtime/helpers/classCallCheck');var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=require('babel-runtime/helpers/createClass');var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=require('babel-runtime/helpers/possibleConstructorReturn');var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=require('babel-runtime/helpers/inherits');var _inherits3=_interopRequireDefault(_inherits2);var _react=require('react');var _react2=_interopRequireDefault(_react);var _propTypes=require('prop-types');var _propTypes2=_interopRequireDefault(_propTypes);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}var SelectElement=function(_React$Component){(0,_inherits3.default)(SelectElement,_React$Component);function SelectElement(){var _ref;var _temp,_this,_ret;(0,_classCallCheck3.default)(this,SelectElement);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}return _ret=(_temp=(_this=(0,_possibleConstructorReturn3.default)(this,(_ref=SelectElement.__proto__||(0,_getPrototypeOf2.default)(SelectElement)).call.apply(_ref,[this].concat(args))),_this),_this.state={tabIndex:_this.props.tabIndex,options:_this.props.options,selectedIndex:_this.props.selectedIndex,hasActiveOptions:false,activeEnter:false,activeIndex:0,activeChars:''},_this.handleFocus=function(){_this.setState({activeIndex:_this.state.selectedIndex});},_this.handleBlur=function(){_this.setState({hasActiveOptions:false});},_this.handleOptionsEnter=function(){_this.setState({activeEnter:true});},_this.handleOptionsLeave=function(){_this.setState({activeEnter:false});},_this.retainFocus=function(){return _this.selectedOption.focus();},_this.acceptFocus=function(){return true;},_this.handleClick=function(){return _this.setState({hasActiveOptions:true});},_this.handleOptionClick=function(index){_this.selectIndex(index);_this.setState({hasActiveOptions:false});_this.props.onChange(index);},_this.handleOptionsKeyPress=function(_ref2){var charCode=_ref2.charCode;_this.handleOptionsKeyChar(charCode);},_this.handleKeyPress=function(_ref3){var charCode=_ref3.charCode;_this.handleKeyChar(charCode);},_this.handleOptionsKeyUp=function(_ref4){var keyCode=_ref4.keyCode;_this.handleOptionsKeyCode(keyCode);},_this.handleKeyUp=function(_ref5){var keyCode=_ref5.keyCode;_this.handleKeyCode(keyCode);},_this.handleRef=function(ref){_this.selectedOption=ref;},_this.selectActiveIndex=function(){_this.setState({selectedIndex:_this.state.activeIndex});_this.setState({hasActiveOptions:false});},_this.createSelectedOption=function(){var _this$state=_this.state,options=_this$state.options,selectedIndex=_this$state.selectedIndex,tabIndex=_this$state.tabIndex,activeEnter=_this$state.activeEnter,hasActiveOptions=_this$state.hasActiveOptions;var selectedOptionText=(options[selectedIndex]||{}).text;return _react2.default.createElement('div',{tabIndex:tabIndex,className:'selectedOption',onFocus:activeEnter?_this.acceptFocus/* Bonkers but I like it. Soz-oh */:_this.handleFocus,onBlur:activeEnter?_this.retainFocus:_this.handleBlur,onClick:_this.handleClick,onKeyPress:hasActiveOptions?_this.handleOptionsKeyPress:_this.handleKeyPress,onKeyUp:hasActiveOptions?_this.handleOptionsKeyUp:_this.handleKeyUp,ref:_this.handleRef},_this.createOptionText(selectedOptionText));},_this.createOption=function(option,index){var optionText=option.text;return _react2.default.createElement('li',{key:index,className:_this.createOptionClassName(index),onMouseOver:function onMouseOver(){return _this.activeIndex(index);},onClick:function onClick(){return _this.handleOptionClick(index);}},_this.createOptionText(optionText));},_temp),(0,_possibleConstructorReturn3.default)(_this,_ret);}/*
    Eep
  *//* kill an arrow function with a bound method to simplify a conditional? */(0,_createClass3.default)(SelectElement,[{key:'findChars',value:function findChars(chars){var options=this.state.options;var i=0;var n=chars.length;var j=options.length;for(i,j;i<j;i=i+1){var option=options[i];var optionText=this.createOptionText(option.text).toLowerCase();if(optionText.substr(0,n)===chars){return i;}}return null;}},{key:'findChar',value:function findChar(char){var options=this.state.options;var i=0;var j=options.length;for(i,j;i<j;i=i+1){var option=options[i];var optionText=this.createOptionText(option.text).toLowerCase();if(optionText.charAt(0)===char){return i;}}return null;}},{key:'handleOptionsKeyChar',value:function handleOptionsKeyChar(keyChar){var activeChars=this.state.activeChars;var char=String.fromCharCode(keyChar).toLowerCase();var chars=activeChars+char;var activeIndex=void 0;if((activeIndex=this.findChars(chars))!==null){this.setState({activeIndex:activeIndex});this.setState({activeChars:chars});}else{if((activeIndex=this.findChar(char))!==null){this.setState({activeIndex:activeIndex});this.setState({activeChars:char});}}}},{key:'handleKeyChar',value:function handleKeyChar(keyChar){var activeChars=this.state.activeChars;var char=String.fromCharCode(keyChar).toLowerCase();var chars=activeChars+char;var selectedIndex=void 0;if((selectedIndex=this.findChars(chars))!==null){this.setState({selectedIndex:selectedIndex});this.setState({activeChars:chars});}else{if((selectedIndex=this.findChar(char))!==null){this.setState({selectedIndex:selectedIndex});this.setState({activeChars:char});}}}},{key:'handleOptionsKeyCode',value:function handleOptionsKeyCode(keyCode){switch(keyCode){case 13:case 32:return this.selectActiveIndex();case 38:// arrow up
return this.decrementActiveIndex();case 40:// arrow down
return this.incrementActiveIndex();}}},{key:'handleKeyCode',value:function handleKeyCode(keyCode){if(keyCode===40){return this.setState({hasActiveOptions:true});}}},{key:'selectIndex',value:function selectIndex(selectedIndex){this.setState({selectedIndex:selectedIndex});}},{key:'activeIndex',value:function activeIndex(_activeIndex){this.setState({activeIndex:_activeIndex});}},{key:'decrementActiveIndex',value:function decrementActiveIndex(){var activeIndex=Math.max(this.state.activeIndex-1,0);this.setState({activeIndex:activeIndex});}},{key:'incrementActiveIndex',value:function incrementActiveIndex(){var activeIndex=Math.min(this.state.activeIndex+1,this.state.options.length-1);this.setState({activeIndex:activeIndex});}},{key:'createOptionText',value:function createOptionText(text){return text!==undefined?text.toString():'\uFEFF';}},{key:'createOptionClassName',value:function createOptionClassName(index){return index===this.state.activeIndex?'option active':'option';}},{key:'createOptionsClassName',value:function createOptionsClassName(){return this.state.hasActiveOptions?'options active':'options';}},{key:'createOptions',value:function createOptions(){var options=this.state.options;if(options.length){return _react2.default.createElement('ul',{className:this.createOptionsClassName(),onMouseEnter:this.handleOptionsEnter,onMouseLeave:this.handleOptionsLeave},options.map(this.createOption));}}/*
   *  I hate 'shouldComponentUpdate()'
  */},{key:'shouldComponentUpdate',value:function shouldComponentUpdate(props,state){return props!==this.props||/* need to look again at the relationship between props and state in this component */state.selectedIndex!==this.state.selectedIndex||state.hasActiveOptions!==this.state.hasActiveOptions||state.activeEnter!==this.state.activeEnter||state.activeIndex!==this.state.activeIndex;}},{key:'render',value:function render(){return _react2.default.createElement('div',{className:'selectElement'},this.createSelectedOption(),this.createOptions());}}]);return SelectElement;}(_react2.default.Component);exports.SelectElement=SelectElement;SelectElement.propTypes={selectedIndex:_propTypes2.default.number,tabIndex:_propTypes2.default.number,options:_propTypes2.default.array,onChange:_propTypes2.default.func};SelectElement.defaultProps={selectedIndex:0,tabIndex:0,options:[],onChange:function onChange(){}};