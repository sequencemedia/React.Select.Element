'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _react=require('react');var _react2=_interopRequireDefault(_react);var _propTypes=require('prop-types');var _propTypes2=_interopRequireDefault(_propTypes);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i];}return target;}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}var toNumber=function toNumber(v){return isNaN(v)?NaN:parseInt(v,10);};/*
 *  'accesskey' events are raised as clicks with all-zero co-ordinates. All-zero
 *  coordinates are (of course) possible, but unlikely. This is a woolly way of
 *  identifying 'accesskey' events
 */var isEventClickLike=function isEventClickLike(_ref){var pageX=_ref.pageX,pageY=_ref.pageY,screenX=_ref.screenX,screenY=_ref.screenY;return!(pageX||pageY||screenX||screenY);};var toOptionText=function toOptionText(t){return t!==undefined?t.toString():'\uFEFF';};var noFocus=function noFocus(e){return e.cancelDefault();};var SelectElement=function(_React$Component){_inherits(SelectElement,_React$Component);function SelectElement(props){_classCallCheck(this,SelectElement);var _this=_possibleConstructorReturn(this,(SelectElement.__proto__||Object.getPrototypeOf(SelectElement)).call(this,props));_initialiseProps.call(_this);var _this$props=_this.props,index=_this$props.index,defaultIndex=_this$props.defaultIndex;var value=toNumber(index);var selectIndex=isNaN(value)?toNumber(defaultIndex):value;var state=_objectWithoutProperties(_this.state,[]);_this.state=_extends({selectIndex:selectIndex},state);return _this;}_createClass(SelectElement,[{key:'findChars',value:function findChars(chars){var options=this.props.options;var n=chars.length;var i=options.findIndex(function(_ref2){var text=_ref2.text;return toOptionText(text).toLowerCase().substr(0,n)===chars;});return i<0?NaN:i;}},{key:'findChar',value:function findChar(char){var options=this.props.options;var i=options.findIndex(function(_ref3){var text=_ref3.text;return toOptionText(text).toLowerCase().charAt(0)===char;});return i<0?NaN:i;}},{key:'handleOptionsKeyChar',value:function handleOptionsKeyChar(keyChar){var activeChars=this.state.activeChars;var char=String.fromCharCode(keyChar).toLowerCase();var chars=activeChars+char;var index=this.findChars(chars);if(!isNaN(index)){this.setState({activeChars:chars});this.activeIndex(index);}else{var _index=this.findChar(char);if(!isNaN(_index)){this.setState({activeChars:char});this.activeIndex(_index);}}}},{key:'handleKeyChar',value:function handleKeyChar(keyChar){var activeChars=this.state.activeChars;var char=String.fromCharCode(keyChar).toLowerCase();var chars=activeChars+char;var index=this.findChars(chars);if(!isNaN(index)){this.setState({activeChars:chars});this.selectIndex(index);}else{if(activeChars!==char){var _index2=this.findChar(char);if(!isNaN(_index2)){this.setState({activeChars:char});this.selectIndex(_index2);}}}}},{key:'handleOptionsKeyCode',value:function handleOptionsKeyCode(keyCode){switch(keyCode){case 13:case 32:{this.setState({hasActiveOptions:false});var activeIndex=this.state.activeIndex;this.selectIndex(activeIndex);}break;case 38:// arrow up
this.decrementActiveIndex();break;case 40:// arrow down
this.incrementActiveIndex();break;}}},{key:'handleKeyCode',value:function handleKeyCode(keyCode){if(keyCode===40){this.setState({hasActiveOptions:true});}}/*
   *  'shouldComponentUpdate()'
   */},{key:'selectIndex',value:function selectIndex(index){var selectIndex=this.state.selectIndex;if(index!==selectIndex){var onChange=this.props.onChange;if(onChange instanceof Function)onChange(index);else{if('index'in this.props)return;this.setState({selectIndex:index});}}}/*
   *  'shouldComponentUpdate()'
   */},{key:'activeIndex',value:function activeIndex(index){var activeIndex=this.state.activeIndex;if(index!==activeIndex){this.setState({activeIndex:index});}}},{key:'decrementActiveIndex',value:function decrementActiveIndex(){var activeIndex=this.state.activeIndex;this.activeIndex(Math.max(activeIndex-1,this.lowerBound));}},{key:'incrementActiveIndex',value:function incrementActiveIndex(){var activeIndex=this.state.activeIndex;this.activeIndex(Math.min(activeIndex+1,this.upperBound));}},{key:'createSelectedOptionDisabled',value:function createSelectedOptionDisabled(){var options=this.props.options;var selectIndex=this.state.selectIndex;var _ref4=options[selectIndex]||{},text=_ref4.text;return _react2.default.createElement('div',{className:'selected-option',ref:this.handleRef},toOptionText(text));}},{key:'createSelectedOption',value:function createSelectedOption(){var _props=this.props,options=_props.options,accessKey=_props.accessKey,tabIndex=_props.tabIndex;var _state=this.state,selectIndex=_state.selectIndex,activeEnter=_state.activeEnter,hasActiveOptions=_state.hasActiveOptions;var _ref5=options[selectIndex]||{},text=_ref5.text;return _react2.default.createElement('div',{accessKey:accessKey,tabIndex:tabIndex,className:'selected-option',onFocus:activeEnter?this.acceptFocus/* Bonkers but I like it. Soz-oh */:this.handleFocus,onBlur:activeEnter?this.optionFocus:this.handleBlur,onClick:this.handleClick,onKeyPress:hasActiveOptions?this.handleOptionsKeyPress:this.handleKeyPress,onKeyUp:hasActiveOptions?this.handleOptionsKeyUp:this.handleKeyUp,ref:this.handleRef},toOptionText(text));}},{key:'createOptionClassName',value:function createOptionClassName(index){return index===this.state.activeIndex?'option active':'option';}},{key:'createOptionsClassName',value:function createOptionsClassName(){return this.state.hasActiveOptions?'options active':'options';}},{key:'createOptionsDisabled',value:function createOptionsDisabled(){var options=this.props.options;if(options.length){return _react2.default.createElement('ul',{className:'options'},options.map(this.createOptionDisabled));}}},{key:'createOptions',value:function createOptions(){var options=this.props.options;if(options.length){return _react2.default.createElement('ul',{className:this.createOptionsClassName(),onMouseEnter:this.handleOptionsEnter,onMouseLeave:this.handleOptionsLeave},options.map(this.createOption));}}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps(_ref6){var index=_ref6.index;var value=toNumber(index);this.setState({selectIndex:isNaN(value)?NaN:value});}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate(props,state){if(props!==this.props)return true;return state.selectIndex!==this.state.selectIndex||state.hasActiveOptions!==this.state.hasActiveOptions||state.activeEnter!==this.state.activeEnter||state.activeIndex!==this.state.activeIndex;}},{key:'render',value:function render(){var disabled=this.props.disabled;return disabled?_react2.default.createElement('div',{className:'react-select-element disabled',onFocus:noFocus},this.createSelectedOptionDisabled(),this.createOptionsDisabled()):_react2.default.createElement('div',{className:'react-select-element'},this.createSelectedOption(),this.createOptions());}},{key:'lowerBound',get:function get(){return 0;}},{key:'upperBound',get:function get(){var n=this.props.options.length;return Math.max(0,n-1);}/* simplify a conditional! */}]);return SelectElement;}(_react2.default.Component);var _initialiseProps=function _initialiseProps(){var _this2=this;this.state={hasActiveOptions:false,activeEnter:false,activeIndex:0,activeChars:''};this.handleFocus=function(){var selectIndex=_this2.state.selectIndex;_this2.activeIndex(selectIndex);};this.handleBlur=function(){_this2.setState({hasActiveOptions:false});};this.handleOptionsEnter=function(){_this2.setState({activeEnter:true});};this.handleOptionsLeave=function(){_this2.setState({activeEnter:false});};this.optionFocus=function(){return _this2.selectedOption.focus();};this.acceptFocus=function(){return true;};this.handleClick=function(event){if(isEventClickLike(event)){// it's probably an accessKey event (which raises a click)
_this2.optionFocus();}else{// it's probably a click
_this2.setState({hasActiveOptions:true});}};this.handleOptionClick=function(index){_this2.setState({hasActiveOptions:false});_this2.selectIndex(index);};this.handleOptionsKeyPress=function(_ref7){var charCode=_ref7.charCode;_this2.handleOptionsKeyChar(charCode);};this.handleKeyPress=function(_ref8){var charCode=_ref8.charCode;_this2.handleKeyChar(charCode);};this.handleOptionsKeyUp=function(_ref9){var keyCode=_ref9.keyCode;_this2.handleOptionsKeyCode(keyCode);};this.handleKeyUp=function(_ref10){var keyCode=_ref10.keyCode;_this2.handleKeyCode(keyCode);};this.handleRef=function(ref){_this2.selectedOption=ref;};this.createOptionDisabled=function(option,index){var text=option.text;return _react2.default.createElement('li',{key:index,className:'option'},toOptionText(text));};this.createOption=function(option,index){var text=option.text;return _react2.default.createElement('li',{key:index,className:_this2.createOptionClassName(index),onMouseOver:function onMouseOver(){return _this2.activeIndex(index);},onClick:function onClick(){return _this2.handleOptionClick(index);}},toOptionText(text));};};exports.default=SelectElement;SelectElement.propTypes={defaultIndex:_propTypes2.default.oneOfType([_propTypes2.default.number,_propTypes2.default.string]),index:_propTypes2.default.oneOfType([_propTypes2.default.number,_propTypes2.default.string]),tabIndex:_propTypes2.default.number,options:_propTypes2.default.array,onChange:_propTypes2.default.func,accessKey:_propTypes2.default.string,disabled:_propTypes2.default.bool};SelectElement.defaultProps={defaultIndex:0,tabIndex:0,options:[],// onChange: () => {},
disabled:false};