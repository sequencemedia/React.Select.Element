'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _react=require('react');var _react2=_interopRequireDefault(_react);var _propTypes=require('prop-types');var _propTypes2=_interopRequireDefault(_propTypes);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}var toNumber=function toNumber(v){return isNaN(v)?0:parseInt(v,10);};/*
 *  User 'accesskey' events are raised as clicks but they have no co-ordinates
 *  (because they're not actually clicks)
 *
 *  This is a woolly way of distinguishing between 'click' and 'click-like' events
 */var isEventProbablyAccessKey=function isEventProbablyAccessKey(_ref){var pageX=_ref.pageX,pageY=_ref.pageY,screenX=_ref.screenX,screenY=_ref.screenY;return!(pageX||pageY||screenX||screenY);};var SelectElement=function(_React$Component){_inherits(SelectElement,_React$Component);function SelectElement(){var _ref2;var _temp,_this,_ret;_classCallCheck(this,SelectElement);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}return _ret=(_temp=(_this=_possibleConstructorReturn(this,(_ref2=SelectElement.__proto__||Object.getPrototypeOf(SelectElement)).call.apply(_ref2,[this].concat(args))),_this),_this.state={selectIndex:toNumber(_this.props.selectedIndex),hasActiveOptions:false,activeEnter:false,activeIndex:0,activeChars:''},_this.handleFocus=function(){var activeIndex=_this.state.selectIndex;_this.setState({activeIndex:activeIndex});},_this.handleBlur=function(){_this.setState({hasActiveOptions:false});},_this.handleOptionsEnter=function(){_this.setState({activeEnter:true});},_this.handleOptionsLeave=function(){_this.setState({activeEnter:false});},_this.returnFocus=function(){return _this.selectedOption.focus();},_this.acceptFocus=function(){return true;},_this.handleClick=function(event){if(isEventProbablyAccessKey(event)){// it's probably an accessKey event (which raises a click)
_this.returnFocus();}else{// it's probably a click
_this.setState({hasActiveOptions:true});}},_this.handleOptionClick=function(index){var onChange=_this.props.onChange;_this.selectIndex(index);_this.setState({hasActiveOptions:false});onChange(index);},_this.handleOptionsKeyPress=function(_ref3){var charCode=_ref3.charCode;_this.handleOptionsKeyChar(charCode);},_this.handleKeyPress=function(_ref4){var charCode=_ref4.charCode;_this.handleKeyChar(charCode);},_this.handleOptionsKeyUp=function(_ref5){var keyCode=_ref5.keyCode;_this.handleOptionsKeyCode(keyCode);},_this.handleKeyUp=function(_ref6){var keyCode=_ref6.keyCode;_this.handleKeyCode(keyCode);},_this.handleRef=function(ref){_this.selectedOption=ref;},_this.createOption=function(option,index){var text=option.text;return _react2.default.createElement('li',{key:index,className:_this.createOptionClassName(index),onMouseOver:function onMouseOver(){return _this.activeIndex(index);},onClick:function onClick(){return _this.handleOptionClick(index);}},_this.createOptionText(text));},_temp),_possibleConstructorReturn(_this,_ret);}_createClass(SelectElement,[{key:'findChars',value:function findChars(chars){var options=this.props.options;var i=0;var n=chars.length;var j=options.length;for(i,j;i<j;i=i+1){var text=options[i].text;var optionText=this.createOptionText(text).toLowerCase();if(optionText.substr(0,n)===chars){return i;}}return NaN;}},{key:'findChar',value:function findChar(char){var options=this.props.options;var i=0;var j=options.length;for(i,j;i<j;i=i+1){var text=options[i].text;var optionText=this.createOptionText(text).toLowerCase();if(optionText.charAt(0)===char){return i;}}return NaN;}},{key:'handleOptionsKeyChar',value:function handleOptionsKeyChar(keyChar){var activeChars=this.state.activeChars;var char=String.fromCharCode(keyChar).toLowerCase();var chars=activeChars+char;var activeIndex=void 0;if(!isNaN(activeIndex=this.findChars(chars))){this.setState({activeIndex:activeIndex});this.setState({activeChars:chars});}else{if(!isNaN(activeIndex=this.findChar(char))){this.setState({activeIndex:activeIndex});this.setState({activeChars:char});}}}},{key:'handleKeyChar',value:function handleKeyChar(keyChar){var activeChars=this.state.activeChars;var char=String.fromCharCode(keyChar).toLowerCase();var chars=activeChars+char;var selectIndex=void 0;if(!isNaN(selectIndex=this.findChars(chars))){var onChange=this.props.onChange;this.setState({selectIndex:selectIndex});this.setState({activeChars:chars});onChange(selectIndex);}else{if(activeChars!==char){if(!isNaN(selectIndex=this.findChar(char))){var _onChange=this.props.onChange;this.setState({selectIndex:selectIndex});this.setState({activeChars:char});_onChange(selectIndex);}}}}},{key:'handleOptionsKeyCode',value:function handleOptionsKeyCode(keyCode){switch(keyCode){case 13:case 32:{var selectIndex=this.state.activeIndex;var onChange=this.props.onChange;this.setState({selectIndex:selectIndex});this.setState({hasActiveOptions:false});onChange(selectIndex);break;}case 38:// arrow up
return this.decrementActiveIndex();case 40:// arrow down
return this.incrementActiveIndex();}}},{key:'handleKeyCode',value:function handleKeyCode(keyCode){if(keyCode===40){this.setState({hasActiveOptions:true});}}},{key:'selectIndex',value:function selectIndex(_selectIndex){this.setState({selectIndex:_selectIndex});}},{key:'activeIndex',value:function activeIndex(_activeIndex){this.setState({activeIndex:_activeIndex});}},{key:'decrementActiveIndex',value:function decrementActiveIndex(){var activeIndex=this.state.activeIndex;this.setState({activeIndex:Math.max(activeIndex-1,this.lowerBound)});}},{key:'incrementActiveIndex',value:function incrementActiveIndex(){var activeIndex=this.state.activeIndex;this.setState({activeIndex:Math.min(activeIndex+1,this.upperBound)});}},{key:'createOptionText',value:function createOptionText(text){return text!==undefined?text.toString():'\uFEFF';}},{key:'createSelectedOption',value:function createSelectedOption(){var _state=this.state,selectIndex=_state.selectIndex,activeEnter=_state.activeEnter,hasActiveOptions=_state.hasActiveOptions;var _props=this.props,options=_props.options,accessKey=_props.accessKey,tabIndex=_props.tabIndex;var _ref7=options[selectIndex]||{},text=_ref7.text;return _react2.default.createElement('div',{accessKey:accessKey,tabIndex:tabIndex,className:'selectedOption',onFocus:activeEnter?this.acceptFocus/* Bonkers but I like it. Soz-oh */:this.handleFocus,onBlur:activeEnter?this.returnFocus:this.handleBlur,onClick:this.handleClick,onKeyPress:hasActiveOptions?this.handleOptionsKeyPress:this.handleKeyPress,onKeyUp:hasActiveOptions?this.handleOptionsKeyUp:this.handleKeyUp,ref:this.handleRef},this.createOptionText(text));}},{key:'createOptionClassName',value:function createOptionClassName(index){return index===this.state.activeIndex?'option active':'option';}},{key:'createOptionsClassName',value:function createOptionsClassName(){return this.state.hasActiveOptions?'options active':'options';}},{key:'createOptions',value:function createOptions(){var options=this.props.options;if(options.length){return _react2.default.createElement('ul',{className:this.createOptionsClassName(),onMouseEnter:this.handleOptionsEnter,onMouseLeave:this.handleOptionsLeave},options.map(this.createOption));}}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps(_ref8){var selectedIndex=_ref8.selectedIndex;this.setState({selectIndex:toNumber(selectedIndex)});}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate(props,state){if(props!==this.props)return true;return state.selectIndex!==this.state.selectIndex||state.hasActiveOptions!==this.state.hasActiveOptions||state.activeEnter!==this.state.activeEnter||state.activeIndex!==this.state.activeIndex;}},{key:'render',value:function render(){return _react2.default.createElement('div',{className:'selectElement'},this.createSelectedOption(),this.createOptions());}},{key:'lowerBound',get:function get(){return 0;}},{key:'upperBound',get:function get(){var n=this.props.options.length;return Math.max(0,n-1);}/* simplify a conditional! */}]);return SelectElement;}(_react2.default.Component);exports.default=SelectElement;SelectElement.propTypes={selectedIndex:_propTypes2.default.oneOfType([_propTypes2.default.number,_propTypes2.default.string]),tabIndex:_propTypes2.default.number,options:_propTypes2.default.array,onChange:_propTypes2.default.func,accessKey:_propTypes2.default.string};SelectElement.defaultProps={selectedIndex:0,tabIndex:0,options:[],onChange:function onChange(){}};