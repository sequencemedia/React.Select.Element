'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _react=require('react');var _react2=_interopRequireDefault(_react);var _reactDom=require('react-dom');var _reactDom2=_interopRequireDefault(_reactDom);var _propTypes=require('prop-types');var _propTypes2=_interopRequireDefault(_propTypes);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}var ENTER='Enter';var SPACE=String.fromCharCode(32);var isKeyEnter=function isKeyEnter(_ref){var key=_ref.key;return key===ENTER;};var isKeySpace=function isKeySpace(_ref2){var key=_ref2.key;return key===SPACE;};/*
 *  'accesskey' events are raised as clicks with all-zero co-ordinates. All-zero
 *  coordinates are (of course) possible, but unlikely. This is a woolly way of
 *  identifying 'accesskey' events
 */var isEventClickLike=function isEventClickLike(_ref3){var pageX=_ref3.pageX,pageY=_ref3.pageY,screenX=_ref3.screenX,screenY=_ref3.screenY;return!(pageX||pageY||screenX||screenY);};var toNumber=function toNumber(v){return isNaN(v)?NaN:parseInt(v,10);};var toOptionText=function toOptionText(t){return t!==undefined?t.toString():'\uFEFF';};var byOptionText=function byOptionText(alpha,omega){var ALPHA=toOptionText(alpha).toLowerCase();var OMEGA=toOptionText(omega).toLowerCase();if(ALPHA<OMEGA)return-1;if(ALPHA>OMEGA)return+1;return 0;};var SelectElement=function(_React$Component){_inherits(SelectElement,_React$Component);function SelectElement(props){_classCallCheck(this,SelectElement);var _this=_possibleConstructorReturn(this,(SelectElement.__proto__||Object.getPrototypeOf(SelectElement)).call(this,props));_initialiseProps.call(_this);var _this$props=_this.props,index=_this$props.index,defaultIndex=_this$props.defaultIndex;var value=toNumber(index);var selectIndex=isNaN(value)?toNumber(defaultIndex):value;_this.state={selectIndex:selectIndex,hasActiveOptions:false,activeEnter:false,activeIndex:0,activeChars:''};return _this;}_createClass(SelectElement,[{key:'scrollOptionIntoView',value:function scrollOptionIntoView(element){if(_reactDom2.default.findDOMNode(this).contains(element)){var options=this.options;var offsetTop=element.offsetTop,offsetHeight=element.offsetHeight;var scrollTop=options.scrollTop,clientHeight=options.clientHeight;var i=clientHeight/2;var j=offsetHeight/2;var n=Math.max(0,offsetTop-i+j);if(n!==scrollTop)options.scrollTop=n;}}},{key:'toLowerBound',value:function toLowerBound(){this.setState({activeIndex:this.lowerBound});}},{key:'toUpperBound',value:function toUpperBound(){this.setState({activeIndex:this.upperBound});}},{key:'selectOptionFocus',value:function selectOptionFocus(){this.selectOption.focus();}},{key:'hasExactMatch',value:function hasExactMatch(chars){var options=this.props.options;/*
     * Matches exactly
     */return options.some(function(_ref4){var text=_ref4.text;return toOptionText(text).toLowerCase()===chars;});}},{key:'getExactMatchIndex',value:function getExactMatchIndex(chars){var options=this.props.options;/*
     * Matches exactly
     */return options.findIndex(function(_ref5){var text=_ref5.text;return toOptionText(text).toLowerCase()===chars;});}},{key:'hasStartMatch',value:function hasStartMatch(chars){var options=this.props.options;var n=chars.length;/*
     * Matches from the start of the string
     */return options.some(function(_ref6){var text=_ref6.text;return toOptionText(text).toLowerCase().substr(0,n)===chars;});}},{key:'getStartMatchIndex',value:function getStartMatchIndex(chars){var options=this.props.options;var n=chars.length;/*
     * Matches from the start of the string
     */return options.findIndex(function(_ref7){var text=_ref7.text;return toOptionText(text).toLowerCase().substr(0,n)===chars;});}},{key:'hasGreaterThanMatch',value:function hasGreaterThanMatch(chars){var options=this.props.options;/*
     *  Find the the smallest match greater than the chars!
     */var a=Array.from(options)// duplicate the array
.sort(function(_ref8,_ref9){var alpha=_ref8.text;var omega=_ref9.text;return(// sort the duplicate
byOptionText(alpha,omega));});var o=a// find in the duplicated, sorted array
.find(function(_ref10){var text=_ref10.text;return toOptionText(text)// the smallest match greater than the chars?
.toLowerCase()>chars;});return options.some(function(option){return option===o;});}},{key:'getGreaterThanMatchIndex',value:function getGreaterThanMatchIndex(chars){var options=this.props.options;/*
     *  Find the the smallest match greater than the chars!
     */var a=Array.from(options)// duplicate the array
.sort(function(_ref11,_ref12){var alpha=_ref11.text;var omega=_ref12.text;return(// sort the duplicate
byOptionText(alpha,omega));});var o=a// find in the duplicated, sorted array
.find(function(_ref13){var text=_ref13.text;return toOptionText(text)// the smallest match greater than the chars?
.toLowerCase()>chars;});return options.findIndex(function(option){return option===o;});}},{key:'hasSmallerThanMatch',value:function hasSmallerThanMatch(chars){var options=this.props.options;/*
     *  Find the the largest match smaller than the chars!
     */var a=Array.from(options)// duplicate the array
.sort(function(_ref14,_ref15){var alpha=_ref14.text;var omega=_ref15.text;return(// sort the duplicate
byOptionText(alpha,omega));});var o=a// find in the duplicated, sorted array
.find(function(_ref16){var text=_ref16.text;return toOptionText(text)// the largest match smaller than the chars?
.toLowerCase()<chars;});return options.some(function(option){return option===o;});}},{key:'getSmallerThanMatchIndex',value:function getSmallerThanMatchIndex(chars){var options=this.props.options;/*
     *  Find the the largest match smaller than the chars!
     */var a=Array.from(options)// duplicate the array
.sort(function(_ref17,_ref18){var alpha=_ref17.text;var omega=_ref18.text;return(// sort the duplicate
byOptionText(alpha,omega));}).reverse();var o=a// find in the duplicated, sorted array
.find(function(_ref19){var text=_ref19.text;return toOptionText(text)// the largest match hasSmallerThanMatch than the chars?
.toLowerCase()<chars;});return options.findIndex(function(option){return option===o;});}},{key:'handleKeySpace',value:function handleKeySpace(){this.setState({hasActiveOptions:false});var activeIndex=this.state.activeIndex;this.selectIndex(activeIndex);}},{key:'handleKeyEnter',value:function handleKeyEnter(){this.setState({hasActiveOptions:false});var activeIndex=this.state.activeIndex;this.selectIndex(activeIndex);}},{key:'handleKeyEscape',value:function handleKeyEscape(){this.setState({hasActiveOptions:false});}},{key:'getOptionsFirstChild',value:function getOptionsFirstChild(){return this.options.firstChild||null;}},{key:'getOptionsLastChild',value:function getOptionsLastChild(){return this.options.lastChild||null;}},{key:'getActiveOptionPreviousSibling',value:function getActiveOptionPreviousSibling(){return this.activeOption.previousSibling||null;}},{key:'getActiveOptionNextSibling',value:function getActiveOptionNextSibling(){return this.activeOption.nextSibling||null;}},{key:'handleKeyArrowUp',value:function handleKeyArrowUp(){this.decrementActiveIndex();this.setState({activeChars:''});}},{key:'handleKeyArrowDown',value:function handleKeyArrowDown(){this.incrementActiveIndex();this.setState({activeChars:''});}},{key:'handleActiveOptionsKeyChar',value:function handleActiveOptionsKeyChar(_ref20){var keyChar=_ref20.charCode;var activeChars=this.state.activeChars;var char=String.fromCharCode(keyChar).toLowerCase();var chars=activeChars+char;if(this.hasExactMatch(chars)){this.setState({activeChars:chars});this.activeIndex(this.getExactMatchIndex(chars));}else{if(this.hasStartMatch(chars)){this.setState({activeChars:chars});this.activeIndex(this.getStartMatchIndex(chars));}else{var CHARS=activeChars.split('');var L=Math.max.apply(CHARS,CHARS.map(function(s){return s.charCodeAt();}));var R=char.charCodeAt();if(L===R&&this.hasGreaterThanMatch(chars)){this.setState({activeChars:activeChars});this.activeIndex(this.getGreaterThanMatchIndex(chars));}else{if(this.hasExactMatch(char)){this.setState({activeChars:char});this.activeIndex(this.getExactMatchIndex(char));}else{if(this.hasStartMatch(char)){this.setState({activeChars:char});this.activeIndex(this.getStartMatchIndex(char));}else{if(this.hasGreaterThanMatch(char)){this.setState({activeChars:''});this.activeIndex(this.getGreaterThanMatchIndex(char));}else{if(this.hasSmallerThanMatch(char)){this.setState({activeChars:''});this.activeIndex(this.getSmallerThanMatchIndex(char));}}}}}}}}},{key:'handleKeyChar',value:function handleKeyChar(_ref21){var keyChar=_ref21.charCode;var activeChars=this.state.activeChars;var char=String.fromCharCode(keyChar).toLowerCase();var chars=activeChars+char;if(this.hasExactMatch(chars)){this.setState({activeChars:chars});this.selectIndex(this.getExactMatchIndex(chars));}else{if(this.hasStartMatch(chars)){this.setState({activeChars:chars});this.selectIndex(this.getStartMatchIndex(chars));}else{if(this.hasExactMatch(char)){this.setState({activeChars:char});this.selectIndex(this.getExactMatchIndex(char));}else{if(this.hasStartMatch(char)){this.setState({activeChars:char});this.selectIndex(this.getStartMatchIndex(char));}else{if(this.hasGreaterThanMatch(char)){this.setState({activeChars:''});this.selectIndex(this.getGreaterThanMatchIndex(char));}}}}}}},{key:'handleActiveOptionsKeyCode',value:function handleActiveOptionsKeyCode(event){var keyCode=event.keyCode;switch(keyCode){case 13:this.handleKeyEnter(event);break;case 27:this.handleKeyEscape(event);break;case 32:this.handleKeySpace(event);break;case 38:this.handleKeyArrowUp(event);break;case 40:this.handleKeyArrowDown(event);break;}}},{key:'handleKeyCode',value:function handleKeyCode(_ref22){var keyCode=_ref22.keyCode;if(keyCode===32||keyCode===38||keyCode===40){// space or arrow up or arrow down
this.setState({hasActiveOptions:true});}}/*
   *  'shouldComponentUpdate()'
   */},{key:'selectIndex',value:function selectIndex(index){var selectIndex=this.state.selectIndex;if(index!==selectIndex){var onChange=this.props.onChange;if(onChange instanceof Function)onChange(index);else{if('index'in this.props)return;this.setState({selectIndex:index});}}}/*
   *  'shouldComponentUpdate()'
   */},{key:'activeIndex',value:function activeIndex(index){var activeIndex=this.state.activeIndex;if(index!==activeIndex){this.setState({activeIndex:index});}}},{key:'decrementActiveIndex',value:function decrementActiveIndex(){var activeIndex=this.state.activeIndex;this.activeIndex(Math.max(activeIndex-1,this.lowerBound));}},{key:'incrementActiveIndex',value:function incrementActiveIndex(){var activeIndex=this.state.activeIndex;this.activeIndex(Math.min(activeIndex+1,this.upperBound));}},{key:'createSelectedOptionDisabled',value:function createSelectedOptionDisabled(){var options=this.props.options;var selectIndex=this.state.selectIndex;var _ref23=options[selectIndex]||{},text=_ref23.text;return _react2.default.createElement('div',{className:'selected-option'},toOptionText(text));}},{key:'createSelectedOptionReadOnly',value:function createSelectedOptionReadOnly(){var options=this.props.options;var selectIndex=this.state.selectIndex;var _ref24=options[selectIndex]||{},text=_ref24.text;return _react2.default.createElement('div',{className:'selected-option'},toOptionText(text));}},{key:'createSelectedOption',value:function createSelectedOption(){var _props=this.props,options=_props.options,accessKey=_props.accessKey,tabIndex=_props.tabIndex;var _state=this.state,selectIndex=_state.selectIndex,activeEnter=_state.activeEnter,hasActiveOptions=_state.hasActiveOptions;var _ref25=options[selectIndex]||{},text=_ref25.text;return _react2.default.createElement('div',{ref:this.selectOptionRef,accessKey:accessKey,tabIndex:tabIndex,className:'selected-option',onFocus:activeEnter?this.handleActiveEnterFocus:this.handleFocus,onBlur:activeEnter?this.handleActiveEnterBlur:this.handleBlur,onClick:this.handleClick,onKeyPress:hasActiveOptions?this.handleActiveOptionsKeyPress:this.handleKeyPress,onKeyUp:hasActiveOptions?this.handleActiveOptionsKeyUp:this.handleKeyUp,onKeyDown:hasActiveOptions?this.handleActiveOptionsKeyDown:this.handleKeyDown},toOptionText(text));}},{key:'createOptionClassName',value:function createOptionClassName(index){var activeIndex=this.state.activeIndex;return index===activeIndex?'option active':'option';}},{key:'createOptionsClassName',value:function createOptionsClassName(){var hasActiveOptions=this.state.hasActiveOptions;return hasActiveOptions?'options active':'options';}},{key:'createOptionsDisabled',value:function createOptionsDisabled(){var options=this.props.options;if(options.length){return _react2.default.createElement('ul',{className:'options'},options.map(this.createOptionDisabled));}}},{key:'createOptionsReadOnly',value:function createOptionsReadOnly(){var options=this.props.options;if(options.length){return _react2.default.createElement('ul',{className:'options'},options.map(this.createOptionReadOnly));}}},{key:'createOptions',value:function createOptions(){var options=this.props.options;if(options.length){return _react2.default.createElement('ul',{ref:this.optionsRef,className:this.createOptionsClassName(),onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave},options.map(this.createOption));}}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps(_ref26){var index=_ref26.index;var selectIndex=toNumber(index);if(!isNaN(selectIndex)){this.setState({selectIndex:selectIndex});}}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate(props,state){if(props!==this.props)return true;return state.selectIndex!==this.state.selectIndex||state.hasActiveOptions!==this.state.hasActiveOptions||state.activeEnter!==this.state.activeEnter||state.activeIndex!==this.state.activeIndex;}},{key:'renderDisabled',value:function renderDisabled(){return _react2.default.createElement('div',{className:'react-select-element disabled'},this.createSelectedOptionDisabled(),this.createOptionsDisabled());}},{key:'renderReadOnly',value:function renderReadOnly(){return _react2.default.createElement('div',{className:'react-select-element readonly'},this.createSelectedOptionReadOnly(),this.createOptionsReadOnly());}},{key:'render',value:function render(){var disabled=this.props.disabled;if(disabled){return this.renderDisabled();}var readOnly=this.props.readOnly;if(readOnly){return this.renderReadOnly();}return _react2.default.createElement('div',{className:'react-select-element'},this.createSelectedOption(),this.createOptions());}},{key:'lowerBound',get:function get(){return 0;}},{key:'upperBound',get:function get(){var n=this.props.options.length;return Math.max(0,n-1);}}]);return SelectElement;}(_react2.default.Component);var _initialiseProps=function _initialiseProps(){var _this2=this;this.handleFocus=function(){var selectIndex=_this2.state.selectIndex;_this2.activeIndex(selectIndex);};this.handleBlur=function(){_this2.setState({hasActiveOptions:false});};this.handleMouseEnter=function(){_this2.setState({activeEnter:true});};this.handleMouseLeave=function(){_this2.setState({activeEnter:false});};this.handleActiveEnterFocus=function(){return true;};this.handleActiveEnterBlur=function(){_this2.selectOptionFocus();};this.handleClick=function(event){if(isEventClickLike(event)){// it's probably an accessKey event
_this2.selectOptionFocus();}else{// it's probably a mouse click
_this2.setState({hasActiveOptions:true});}};this.handleOptionClick=function(index){_this2.setState({hasActiveOptions:false});_this2.selectIndex(index);_this2.selectOptionFocus();};this.handleActiveOptionsKeyPress=function(event){if(isKeyEnter(event)||isKeySpace(event))return;return _this2.handleActiveOptionsKeyChar(event);};this.handleKeyPress=function(event){return _this2.handleKeyChar(event);};this.handleActiveOptionsKeyUp=function(event){return _this2.handleActiveOptionsKeyCode(event);};this.handleActiveOptionsKeyDown=function(){return true;};this.handleKeyUp=function(event){return _this2.handleKeyCode(event);};this.handleKeyDown=function(){return true;};this.selectOptionRef=function(ref){return ref?!!(_this2.selectOption=ref):delete _this2.selectOption;};this.optionsRef=function(ref){return ref?!!(_this2.options=ref):delete _this2.options;};this.activeOptionRef=function(ref){return ref?!!(_this2.activeOption=ref):delete _this2.activeOption;};this.createOptionRef=function(index){var activeIndex=_this2.state.activeIndex;if(index===activeIndex){return _this2.activeOptionRef;}};this.createOptionDisabled=function(option,index){var text=option.text;return _react2.default.createElement('li',{key:index,className:'option'},toOptionText(text));};this.createOptionReadOnly=function(option,index){var text=option.text;return _react2.default.createElement('li',{key:index,className:'option'},toOptionText(text));};this.createOption=function(option,index){var text=option.text;return _react2.default.createElement('li',{key:index,ref:_this2.createOptionRef(index),className:_this2.createOptionClassName(index),onMouseOver:function onMouseOver(){return _this2.activeIndex(index);},onClick:function onClick(){return _this2.handleOptionClick(index);}},toOptionText(text));};};exports.default=SelectElement;SelectElement.propTypes={defaultIndex:_propTypes2.default.oneOfType([_propTypes2.default.number,_propTypes2.default.string]),index:_propTypes2.default.oneOfType([_propTypes2.default.number,_propTypes2.default.string]),tabIndex:_propTypes2.default.number,options:_propTypes2.default.arrayOf(_propTypes2.default.shape({text:_propTypes2.default.oneOfType([_propTypes2.default.number,_propTypes2.default.string])})),onChange:_propTypes2.default.func,accessKey:_propTypes2.default.string,disabled:_propTypes2.default.bool,readOnly:_propTypes2.default.bool};SelectElement.defaultProps={defaultIndex:0,tabIndex:0,options:[],disabled:false,readOnly:false};